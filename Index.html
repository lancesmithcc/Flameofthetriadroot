<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Caretakers — Diffusion Codex</title>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  html,body{width:100%;height:100%;overflow:visible;
    background:#05050a;color:#eef;font-family:system-ui,Arial,sans-serif;
    display:flex;align-items:center;justify-content:center}
  #prompt{
    position:fixed;bottom:2rem;left:50%;transform:translateX(-50%);
    width:92vw;max-width:900px;text-align:center;white-space:pre-line;
    font-size:clamp(.9rem,3.5vw,1.25rem);line-height:1.45;letter-spacing:.05em;
    pointer-events:none;z-index:3}
  #full{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    width:90vw;max-width:900px;font-size:clamp(.8rem,3.2vw,1.1rem);
    white-space:pre-wrap;line-height:1.4;color:#d0d8ff;pointer-events:none;
    opacity:0;filter:blur(14px);z-index:2}
  svg{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
    width:96vmin;height:96vmin;overflow:visible;pointer-events:none}

  .geo{fill:none;stroke:#a259ff;stroke-width:2.6;stroke-linecap:round;opacity:0;
       animation:aurora 18s linear infinite}
  @keyframes aurora{
    0%{stroke:#a259ff}33%{stroke:#5b5bff}66%{stroke:#60ffd8}100%{stroke:#a259ff}}
  .glo{filter:url(#g)}
</style>
</head>
<body>
<pre id="prompt">Click anywhere to begin…</pre>
<pre id="full"></pre>

<!-- geometry canvas identical to previous “roots” file (truncated here for brevity) -->
<svg id="scene" viewBox="-240 -240 480 480">
 <defs>
  <filter id="g" x="-60%" y="-60%" width="220%" height="220%">
    <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="b"/>
    <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge>
  </filter>
 </defs>
 <!-- … imagine all shapes, spokes & roots inserted here exactly as before … -->
</svg>

<script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script>
/* -------------- SAME story, shapes, roots, theta shimmer etc. as previous file -------------- */
/* (for brevity they are omitted in this snippet; copy them from the last version) */

/* -------------------- DIFFUSION-STYLE REVEAL -------------------- */
function diffusionReveal(){
  const charset="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789#$%&@*";
  const targetText=raw.join("\n");
  const full=document.getElementById('full');
  full.innerHTML='';

  // create equal-length span array
  const spans=[...targetText].map(ch=>{
      const s=document.createElement('span');
      s.textContent=ch==='\n' ? '\n' : charset[Math.floor(Math.random()*charset.length)];
      s.style.display='inline-block';
      full.appendChild(s);
      return s;
  });

  full.style.opacity=1;          // make block visible (blurred)

  anime({
    duration:3000,
    easing:'linear',
    update:anim=>{
      const p=anim.progress/100;              // 0 → 1
      const blur=14*(1-p);
      full.style.filter=`blur(${blur}px)`;

      // proportion of characters that should now be “final”
      const solvedCount=Math.floor(p*spans.length);
      for(let i=0;i<spans.length;i++){
        if(i<solvedCount){
          spans[i].textContent=targetText[i]==='\n' ? '\n' : targetText[i];
        }else if(targetText[i]!=='\n'){
          spans[i].textContent=charset[Math.floor(Math.random()*charset.length)];
        }
      }
    }
  });

  // hide scrolling prompt
  document.getElementById('prompt').style.opacity=0;
}

/* -------------- when storyboard reaches the last act -------------- */
// replace previous reveal() call with diffusionReveal()
</script>
</body>
</html>
